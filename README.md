# Publitas Backend Challenge

This is a product parser and batcher app built with Ruby during the Publitas hiring process.

## Getting Started

To get started, you need to have [Ruby](https://www.ruby-lang.org/en/) 2.0 or newer installed on your machine.

Then, you can clone this repository and install the dependencies:

```bash
git clone https://github.com/vpsantos/publitas-be-challenge.git
cd publitas-be-challenge
bundle install
```

## Dependencies

This project uses the following gems:

*   [nokogiri](https://nokogiri.org/): To parse the XML feed.
*   [rspec](https://rspec.info/): For testing.

## Project Structure

*   `assignment.rb`: The main script that parses the XML feed, batches the products, and sends them to the external service.
*   `helpers.rb`: Contains helper functions used in the main script.
*   `services/ExternalService.rb`: A mock external service that receives the batched products.
*   `data/feed.xml`: The XML feed containing the products.
*   `spec/`: Contains the tests for the project.
    *   `assignment_spec.rb`: Tests for the `assignment.rb` script.
    *   `helpers_spec.rb`: Tests for the `helpers.rb` script.
    *   `spec_helper.rb`: RSpec helper file.
*   `Gemfile`: Lists the project's dependencies.
*   `Gemfile.lock`: The generated file that locks the gem versions. This file is automatically generated by Bundler.

## Usage

To run the application, execute the following command:

```bash
ruby assignment.rb
```

This will parse the `data/feed.xml` file, group the products into batches, and send them to a mock external service, printing the output to the console. The `ExternalService` is a mock service that simulates an external service.

### Example Output

```
Received batch   1
Size:       4.99MB
Products:    14700

Received batch   2
Size:       4.93MB
Products:    14700

Received batch   3
Size:       4.02MB
Products:    14700

Received batch   4
Size:       2.26MB
Products:     5971
```

## Configuration

The batch size is currently hardcoded in the `assignment.rb` file as `@batch_size = 14700`. This number was calculated based on the average size of a product in the `feed.xml` file to keep the batch size below 5MB. To change it, you need to edit this variable directly in the script.

## Testing

This project uses [RSpec](https://rspec.info/) for testing. To run the tests, use the following command:

```bash
bundle exec rspec
```